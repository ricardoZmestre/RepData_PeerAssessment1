---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r globaloptions, echo=FALSE, results='markup', warning=FALSE, message=FALSE}
library(dplyr)
library(knitr)

opts_chunk$set(echo=FALSE, results='markup')
```

## Loading and preprocessing the data

Loading from dataset **activity.zip**. The file can be found in [forked Git repo for the assignment](https://github.com/ricardoZmestre/RepData_PeerAssessment1).

```{r dataloading}

# read directly compressed file
df <- read.csv(ff <- unz('activity.zip', 'activity.csv'), 
               colClasses = c('numeric', 'Date', 'numeric'))
#close(ff)

```

## What is mean total number of steps taken per day?

Histogram of the number of steps taken per day.

```{r question_1}
### Question 1

dfDay <- df %>%
  filter(!is.na(steps)) %>%
  group_by(date) %>%
  summarise(steps=sum(steps))

hist(dfDay$steps, col='lightblue', breaks=10, 
     main = 'Histogram', xlab='Steps Per Day')

```

The overall total number of steps taken per day is `r sprintf('%.0f', sum(dfDay$steps))`.

The mean of the steps taken per day is `r sprintf('%.2f', mean(dfDay$steps))`.

The median of the steps taken per day is `r sprintf('%.2f', median(dfDay$steps))`.

## What is the average daily activity pattern?

```{r question 2}

dfmeanMin <- df %>%
  filter(!is.na(steps)) %>%
  group_by(interval) %>%
  summarise(steps=mean(steps))

oldpar=par(mar=c(3, 3, 3, 2))
plot(dfmeanMin$interval, dfmeanMin$steps, type='l', main='Mean Steps per 5-minute Interval',
     xlab='', ylab='')
par(mar=oldpar)

```

The maximum mean number of steps per day is `r sprintf('%.2f', arrange(dfmeanMin, -steps)[[1,2]])`.

The corresponding period is `r arrange(dfmeanMin, -steps)[[1,1]]`.

## Imputing missing values

NA imputations using linear fit.

```{r NA allocation, results='asis'}
### Question 3

library(xtable)

dfnan <- df
# Filling out with overall mean of steps
dfnan$steps[is.na(df$steps)] <- mean(df$steps, na.rm=TRUE)

# Filling out with linear regression
msteps <- lm(steps ~ interval, data=df, na.action=na.exclude)
print(xtable(msteps), type=, 'html')
fit <- predict(msteps, dfnan)
dfnan$steps[is.na(df$steps)] <- fit[is.na(df$steps)]

dfnanDay <- dfnan %>%
  group_by(date) %>%
  summarise(steps=sum(steps))

```

```{r question 3}
hist(dfnanDay$steps, col='lightblue', breaks=10,
     main = 'Histogram', xlab='Mean Steps Per Day')

```

The number of Nas in the original dataset is `r sum(is.na(df$steps))`.

The mean of the steps taken per day, corrected for Nas, is `r sprintf('%.2f', mean(dfnanDay$steps))`.

The median of the steps taken per day, corrected for Nas, is `r sprintf('%.2f', median(dfnanDay$steps))`.

## Are there differences in activity patterns between weekdays and weekends?

```{r question 4}

library(lubridate)
library(lattice)

dfwe <- df
#dfwe$weekend <- weekdays(df$date) %in% c('Saterday', 'Sunday')
dfwe$dayofweek <- factor(ifelse(weekdays(df$date) %in% c('Saterday', 'Sunday'), 
                 'weekdend', 'weekday'))

dfweMin <- dfwe %>%
  filter(!is.na(steps)) %>%
  group_by(dayofweek,interval) %>%
  summarise(steps=mean(steps))

xyplot(steps ~ interval | dayofweek, data=dfweMin, type='l', layout=c(1, 2),
       xlab='Interval', ylab='Number of steps')
```

Indeed: on weekends, the number of paces is more evenly distributed across the day, and overall there is less walking on weekdays than on weekends.

---
